<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Download Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">Text To Speech Server</h1>
        <div>See API documentation here: <a target="_blank"
                href="https://github.com/lojik-ng/docker-tts-api-ui">https://github.com/lojik-ng/docker-tts-api-ui</a>
        </div>
        <!-- Form 1 -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>Use a Cloned Voice</h4>
            </div>
            <div class="card-body">
                <p>Send a POST request to <code>/use-voice</code> with <code>{prompt, apiKey, speaker}</code></p>
                <p>To get list of available cloned voices, Send a GET request to <code>/list-voices</code></p>
                <p>Add .wav voice samples to <code>voices</code> folder to automatically include them as
                    cloned voices</p>
                <form id="voiceForm" action="/use-voice" method="POST">
                    <div class="mb-3">
                        <label for="apiKey" class="form-label">API Key</label>
                        <input type="text" id="apiKey" name="apiKey" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="text1" class="form-label">Prompt/Text</label>
                        <textarea id="text1" name="prompt" class="form-control" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="voice1" class="form-label">Speaker</label>
                        <select id="voice1" name="speaker" class="form-select" required>
                            <option value="">Select A Voice</option>
                            <!-- Add options here -->
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary submit">Submit</button>
                </form>

            </div>
        </div>
        <div id="loading" class="text-center d-none">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 100 100"
                preserveAspectRatio="xMidYMid" width="300" height="300" class="mx-auto"
                style="shape-rendering: auto; display: block; background: transparent;">
                <g>
                    <rect fill="#095280" height="20" width="20" y="19" x="19">
                        <animate calcMode="discrete" begin="0s" repeatCount="indefinite" dur="1s" keyTimes="0;0.125;1"
                            values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="19" x="40">
                        <animate calcMode="discrete" begin="0.125s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="19" x="61">
                        <animate calcMode="discrete" begin="0.25s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="40" x="19">
                        <animate calcMode="discrete" begin="0.875s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="40" x="61">
                        <animate calcMode="discrete" begin="0.375s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="61" x="19">
                        <animate calcMode="discrete" begin="0.75s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="61" x="40">
                        <animate calcMode="discrete" begin="0.625s" repeatCount="indefinite" dur="1s"
                            keyTimes="0;0.125;1" values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <rect fill="#095280" height="20" width="20" y="61" x="61">
                        <animate calcMode="discrete" begin="0.5s" repeatCount="indefinite" dur="1s" keyTimes="0;0.125;1"
                            values="#00a1f1;#095280;#095280" attributeName="fill" />
                    </rect>
                    <g />
                </g><!-- [ldio] generated by https://loading.io -->
            </svg>
            <h5 style="display: block; text-align: center;">Please wait...</h5>
        </div>
        <!-- Form 2 -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>Use Default Models</h4>
            </div>
            <div class="card-body">
                <p>Send a POST request to <code>/use-model</code> with <code>{prompt, apiKey, speaker}</code></p>
                <p>To get list of available default voices, Send a GET request to <code>/list-models</code></p>
                <form id="modelForm" action="/use-model" method="POST">
                    <div class="mb-3">
                        <label for="apiKey2" class="form-label">API Key</label>
                        <input type="text" id="apiKey2" name="apiKey" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="text2" class="form-label">Prompt/Text</label>
                        <textarea id="text2" name="prompt" class="form-control" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="voice2" class="form-label">Speaker</label>
                        <select id="voice2" name="speaker" class="form-select" required>
                            <option value="">Select A Voice</option>
                            <!-- Add options here -->
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
    <div class="p-5 m-5">&nbsp;</div>
    <div class="bg-secondary fixed-bottom p-2">
        <div class="container">
            <audio src="" autoplay controls class="form-control" id="audio1"></audio>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const voices1 = document.getElementById('voice1');
        const voices2 = document.getElementById('voice2');
        const loading = document.getElementById('loading');
        const audio1 = document.getElementById('audio1');
        const form = document.getElementById('voiceForm');
        form.addEventListener('submit', handleSubmit);
        const form2 = document.getElementById('modelForm');
        form2.addEventListener('submit', handleSubmit);
        // make a get request to /list-voices to get the list of voices
        fetch('/list-voices')
            .then(response => response.json())
            .then(data => {
                // add the voices to the select options
                data.speakers.forEach(speaker => {
                    const option = document.createElement('option');
                    option.value = speaker;
                    option.text = speaker;
                    voices1.appendChild(option);
                });
            })
            .catch(error => console.error(error));


        // make a get request to /list-models to get the list of voices
        fetch('/list-models')
            .then(response => response.json())
            .then(data => {
                // add the voices to the select options
                data.speakers.forEach(speaker => {
                    const option = document.createElement('option');
                    option.value = speaker;
                    option.text = speaker;
                    voices2.appendChild(option);
                });
            })
            .catch(error => console.error(error));

        async function handleSubmit(event) {
            event.preventDefault();
            // disable all .submit buttons
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('d-none');
            });
            loading.classList.remove('d-none');
            // /make a post`` request 
            const endpoint = event.target.id == 'modelForm' ? '/use-model' : '/use-voice';
            const response = await fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt: event.target.prompt.value,
                    apiKey: event.target.apiKey.value,
                    speaker: event.target.speaker.value,
                    forceDownload: false
                })
            });
            const data = await response.json();
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('d-none');
            });

            loading.classList.add('d-none');
            if (!response.ok) {
                alert('Error: ' + response.statusText);
            } else if (data.error) {
                alert('Error: ' + response.error);
            } else {
                audio1.src = data.filename;
                audio1.play();
            }
        }

    </script>
</body>

</html>